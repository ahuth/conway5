<!DOCTYPE html>
<html lang="en">
  <head>
    <script type="module">
      import {
        memory,
        evolveCells,
        getCell,
        setCell,
        UNIVERSE_SIZE,
      } from "./build/release.js";

      const wasmByteMemoryArray = new Uint8Array(memory.buffer);
      const canvas = document.querySelector("canvas");
      const context = canvas.getContext("2d");
      const size = UNIVERSE_SIZE.value;
      const cellHeight = canvas.height / size;
      const cellWidth = canvas.width / size;

      // Randomize the cells to start.
      const rand = () => Math.floor(Math.random() * 50);
      for (let i = 0; i < 500; i++) {
        setCell(rand(), rand(), 1);
      }

      function draw() {
        evolveCells();

        // Clear the canvas
        context.clearRect(0, 0, canvas.width, canvas.height);

        // Draw the cells.
        for (let x = 0; x < size; x++) {
          for (let y = 0; y < size; y++) {
            if (getCell(x, y)) {
              context.fillRect(x * cellWidth, y * cellHeight, cellWidth, cellHeight);
            }
          }
        }
      }

      draw();

      setInterval(() => {
        draw();
      }, 100);
    </script>
  </head>
  <body>
    <canvas
      width="750"
      height="750"
      style="image-rendering: crisp-edges; width: 100%"
    >
    </canvas>
  </body>
</html>
